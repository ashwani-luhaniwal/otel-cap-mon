"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EnvDetector = void 0;
const xsenv = require("@sap/xsenv");
xsenv.loadEnv();
const logger_1 = require("../common/logger");
const Constants_1 = require("./Constants");
let isInfrastructureSupported = false;
let isPrerequisitesMatched = false;
let detectedInfrastructure;
function validateInfrastructure() {
    if (process.env.VCAP_SERVICES) {
        detectedInfrastructure = Constants_1.Environment.CF;
        isInfrastructureSupported = true;
        const VCAP_SERVICES = JSON.parse(process.env.VCAP_SERVICES);
        const DESTINATION = VCAP_SERVICES.destination;
        if (DESTINATION) {
            logger_1.logger.info(`EnvDetector : CloudFoundry Environment detected, destination service binding present in VCAP_SERVICES`);
            isPrerequisitesMatched = true;
        }
        else {
            logger_1.logger.error(`EnvDetector : Destination service binding not present in VCAP_SERVICES`);
            isPrerequisitesMatched = false;
        }
    }
    else {
        logger_1.logger.error(`EnvDetector : Infrastructure not supported`);
        isInfrastructureSupported = false;
    }
    return {
        isInfrastructureSupported: isInfrastructureSupported,
        isPrerequisitesMatched: isPrerequisitesMatched,
        detectedInfrastructure: detectedInfrastructure
    };
}
exports.EnvDetector = {
    validateInfrastructure: validateInfrastructure
};

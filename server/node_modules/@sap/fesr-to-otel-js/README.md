[![Build Status](https://gkepasswd.jaas-gcp.cloud.sap.corp/buildStatus/icon?style=flat-square&job=xdsr%2Ffesr-to-otel-js%2Fmain)](https://gkepasswd.jaas-gcp.cloud.sap.corp/job/xdsr/job/fesr-to-otel-js/job/main/)
[![node](https://img.shields.io/badge/fesr--to--otel--js-1.5.0-blue?style=flat-square)](https://int.repositories.cloud.sap/)
[![Quality Gate Status](https://sonar.tools.sap/api/project_badges/measure?project=fesr-to-otel-js&metric=alert_status&token=4f0868ef9a00e157a5ac1f5ced6db98bafea7738)](https://sonar.tools.sap/dashboard?id=fesr-to-otel-js)
[![Maintainability Rating](https://sonar.tools.sap/api/project_badges/measure?project=fesr-to-otel-js&metric=sqale_rating&token=4f0868ef9a00e157a5ac1f5ced6db98bafea7738)](https://sonar.tools.sap/dashboard?id=fesr-to-otel-js)
[![Security Rating](https://sonar.tools.sap/api/project_badges/measure?project=fesr-to-otel-js&metric=security_rating&token=4f0868ef9a00e157a5ac1f5ced6db98bafea7738)](https://sonar.tools.sap/dashboard?id=fesr-to-otel-js)
[![Coverage](https://sonar.tools.sap/api/project_badges/measure?project=fesr-to-otel-js&metric=coverage&token=4f0868ef9a00e157a5ac1f5ced6db98bafea7738)](https://sonar.tools.sap/dashboard?id=fesr-to-otel-js)

# fesr-to-otel-js
A node js convenience library that provides an FESR beacon handler that will receive FESR and exports these via OpenTelemetry.

# Setup

In package.json:

```json
{
     "dependencies": {
        "@sap/fesr-to-otel-js" : "^1.5.0"
     },
}
```
## express

If your application uses `express` you can simply register the endpoint to your existing application:

```javascript
const express = require('express');
const fesr = require("@sap/fesr-to-otel-js");
const app = express();

fesr.registerFesrEndpoint(app);
app.listen(3000);
```

## CAP 
For CAP node js applications create a file `server.js`. In this file you can hook onto the bootstrap event of CAP to register the endpoint:

```javascript
const cds = require("@sap/cds");
const fesr = require("@sap/fesr-to-otel-js");

cds.on("bootstrap", (app) => fesr.registerFesrEndpoint(app));

module.exports = cds.server;
```
## Logging
Log level can be specified via the the `SAP_CALM_FESR_LOG_LEVEL` environment variable, e.g.
```
SAP_CALM_FESR_LOG_LEVEL=debug
```
